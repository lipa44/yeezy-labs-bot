// An interface between Redis and Telegraph
// ---------------------------------------------------------------------- //

module.exports.install = function(server) {
  
  var info   = server.database
  ,   redis  = require('redis')
  ,   dir    = process.cwd() + "/db/";

  var client = server.db = redis.createClient(info.port, info.host, info.options);
  client.auth(info.auth);


  // Events
  // -------------------------------------------------- //

  client.on("connect", function() {
    server.info("Redis ".cyan + "is connected at " + client.host.cyan + ":" + client.port.toString().cyan);
  });

  client.on("end", function() {
    server.warn("Redis ".cyan + "has disconnected.");
  });
  
  client.on("error", function (err) {
    server.error(client.host + ":" + client.port + " - " + err);
    server.emit("db-error");
  });
  
  client.on("subscribe", function (channel, count) {
    server.emit("db-subscribe");
  });
  
  client.on("unsubscribe", function (channel, count) {
    server.emit("db-unsubscribe");
  });
  

  // The Model
  // -------------------------------------------------- //

  require('./model')(server);

};
