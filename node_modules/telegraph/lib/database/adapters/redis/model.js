
// Redis Data Blueprint (Or there approximate)
// -------------------------------------------------- //

var _ = require('underscore');

module.exports = function(server) {

  var db = server.db;

  // The Redis Flavored Model
  //
  // name: The name of the resource to be used
  // design: A common datamodel
  // -------------------------------------------------- //

  server.Model = function RedisBlueprint(name, design) {

    var self = RedisBlueprint;
    
    self.name     = name;
    self.design   = design;


    // Setter
    // -------------------------------------------------- //

    self.save = function(data, callback) {

      var attributes = _.extend(design, data);

      db.incr( 'nextid' , function( err, id ) {
        db.set(name + ":" + id, JSON.stringify(attributes), callback);
      });

    };


    // Generic finder function
    // -------------------------------------------------- //

    self.find = function(id, callback) {
        db.get(name + ":" + id, callback);
    };



    // Finalize
    // -------------------------------------------------- //

    return self;

  };

};
