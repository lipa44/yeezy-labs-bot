
// The Design Document

Todo = App.Model("todo", {

  validate_doc_update: function (newDoc, oldDoc, usrCtx) {

    var type = (oldDoc || newDoc)['type'];
    
    function validate(beTrue, message) {
      if (!beTrue) throw ({ error : message });
    }

    validate(newDoc.type === "todo", "Todo type is not 'todo'");
    validate(!!newDoc.task, "Todo items require a task");
    
  },
  
  views: {

    all: {
      map: function(doc) { 
        if (doc.type === 'todo') { 
          emit(null, doc);
        }
      }
    },
    
    unfinished: {
      map: function(doc) { 
        if (doc.done === false && doc.type === 'todo') { 
          emit(null, doc);
        }
      }
    },
    
    finished: {
      map: function(doc) { 
        if (doc.done === true && doc.type === 'todo') { 
          emit(null, doc);
        }
      }
    },

    "no-task": {
      map: function(doc) { 
        if (!doc.task && doc.type === 'todo') { 
          emit(null, doc);
        }
      }
    }
  }

});
